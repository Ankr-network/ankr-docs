name: 'Scrape'

on:
  workflow_dispatch:
    inputs:
      environment:
        type: choice
        description: Target
        required: true
        options:
          - STAGE # www-stage.ankr.com/docs/
          - BS1 # https://bs-1-stage.dccn.ankr.com/docs/
          - BS2 # https://bs-2-stage.dccn.ankr.com/docs/
          - BS3 # https://bs-3-stage.dccn.ankr.com/docs/
          - BS4 # https://bs-4-stage.dccn.ankr.com/docs/
          - PROD # www.ankr.com/docs/

jobs:
  scrape:
    name: Rebuild Index
    runs-on: ubuntu-latest
#    container:
#      image: typesense/docsearch-scraper:latest
    steps:
      - uses: actions/checkout@v2
      - name: Get DocSearch configuration
        id: docsearch-config
        run: |
          echo "::set-output name=json::$(cat config.json | jq -r tostring)"
      - name: Get docsearch scraper docker image
        run: docker pull typesense/docsearch-scraper:latest
      - name: Indexing
        env:
          TZ: UTC
          TYPESENSE_API_KEY: moRF0AiCbLA5XuPxN4ScOBv23u6Hk7a9
          TYPESENSE_HOST: qzgv7l0sbumwafy3p-1.a1.typesense.net
          TYPESENSE_PORT: 443
          TYPESENSE_PROTOCOL: https
          CONFIG: ${{ steps.docsearch-config.outputs.json }}
        run: |
          echo "CONFIG=$CONFIG"
          docker run -e CONFIG -e TZ -e TYPESENSE_API_KEY -e TYPESENSE_HOST -e TYPESENSE_PORT -e TYPESENSE_PROTOCOL  typesense/docsearch-scraper
